# =============================================================================
# SaaS Multi-Tenant Backend Platform - Environment Configuration Template
# =============================================================================
# This file shows ALL available environment variables for the platform.
#
# IMPORTANT: Choose your secrets management approach:
#
# OPTION 1: HashiCorp Vault (Recommended for Production)
#   - Copy .env.docker.minimal to .env (contains NO secrets)
#   - Manage secrets in vault/init-data/docker.env
#   - Secrets are automatically loaded from Vault at runtime
#   - See: README.md "Quick Start - Option A"
#
# OPTION 2: Environment Variables (Simple Development)
#   - Copy .env.docker to .env (contains secrets)
#   - WARNING: Never commit .env with real credentials!
#   - See: README.md "Quick Start - Option B"
#
# This .env.example file is for reference only - it documents all variables.
# =============================================================================

# -----------------------------------------------------------------------------
# Flask Application Settings
# -----------------------------------------------------------------------------
FLASK_APP=app
FLASK_ENV=development
FLASK_DEBUG=True
FLASK_PORT=4999
SECRET_KEY=your-secret-key-here-change-in-production

# -----------------------------------------------------------------------------
# Database Configuration
# -----------------------------------------------------------------------------
# Main database (stores users, tenants, associations)
DATABASE_URL=postgresql://postgres:postgres@localhost:5432/saas_platform
DATABASE_POOL_SIZE=10
DATABASE_POOL_TIMEOUT=30
DATABASE_POOL_RECYCLE=3600
DATABASE_MAX_OVERFLOW=20

# Tenant database connection template (will be interpolated with tenant DB name)
TENANT_DATABASE_URL_TEMPLATE=postgresql://postgres:postgres@localhost:5432/{database_name}

# -----------------------------------------------------------------------------
# JWT Authentication Settings
# -----------------------------------------------------------------------------
# IMPORTANT: Generate a secure random key for production!
# Example: python -c "import secrets; print(secrets.token_urlsafe(32))"
JWT_SECRET_KEY=your-jwt-secret-key-change-in-production
JWT_ACCESS_TOKEN_EXPIRES=900        # 15 minutes (in seconds)
JWT_REFRESH_TOKEN_EXPIRES=604800    # 7 days (in seconds)
JWT_ALGORITHM=HS256

# -----------------------------------------------------------------------------
# Kafka Configuration
# -----------------------------------------------------------------------------
KAFKA_BOOTSTRAP_SERVERS=localhost:9092
KAFKA_CLIENT_ID=saas-backend
KAFKA_GROUP_ID=saas-backend-consumer-group
KAFKA_AUTO_OFFSET_RESET=earliest
KAFKA_ENABLE_AUTO_COMMIT=True

# Kafka Topics
KAFKA_TOPIC_TENANT_CREATED=tenant.created
KAFKA_TOPIC_TENANT_DELETED=tenant.deleted
KAFKA_TOPIC_DOCUMENT_UPLOADED=document.uploaded
KAFKA_TOPIC_DOCUMENT_DELETED=document.deleted
KAFKA_TOPIC_FILE_PROCESS=file.process
KAFKA_TOPIC_AUDIT_LOG=audit.log

# -----------------------------------------------------------------------------
# S3 / Object Storage Configuration
# -----------------------------------------------------------------------------
# S3-compatible storage (AWS S3, MinIO, DigitalOcean Spaces, etc.)
S3_ENDPOINT_URL=https://s3.amazonaws.com        # Internal URL (backend → S3/MinIO)
S3_PUBLIC_URL=https://s3.amazonaws.com          # Public URL (client → S3/MinIO)
                                                # Use http://localhost:9000 for local MinIO
                                                # Use https://documents.example.com for production CDN/MinIO
S3_REGION=us-east-1
S3_BUCKET_NAME=saas-platform-files
S3_ACCESS_KEY_ID=your-access-key-id
S3_SECRET_ACCESS_KEY=your-secret-access-key

# S3 Settings
S3_USE_SSL=True
S3_VERIFY_SSL=True
S3_SIGNATURE_VERSION=s3v4

# File upload limits
MAX_FILE_SIZE_MB=100
ALLOWED_FILE_EXTENSIONS=pdf,doc,docx,xls,xlsx,ppt,pptx,txt,jpg,jpeg,png,gif

# -----------------------------------------------------------------------------
# CORS Settings
# -----------------------------------------------------------------------------
CORS_ORIGINS=http://localhost:3000,http://localhost:4200
CORS_ALLOW_CREDENTIALS=True
CORS_MAX_AGE=3600

# -----------------------------------------------------------------------------
# Logging Configuration
# -----------------------------------------------------------------------------
LOG_LEVEL=INFO
LOG_FORMAT=%(asctime)s - %(name)s - %(levelname)s - %(message)s
LOG_FILE=logs/app.log
LOG_MAX_BYTES=10485760    # 10MB
LOG_BACKUP_COUNT=5

# -----------------------------------------------------------------------------
# Security Settings
# -----------------------------------------------------------------------------
# Rate limiting
RATE_LIMIT_ENABLED=True
RATE_LIMIT_DEFAULT=100/hour
RATE_LIMIT_LOGIN=5/minute

# Session settings
SESSION_COOKIE_SECURE=False    # Set to True in production with HTTPS
SESSION_COOKIE_HTTPONLY=True
SESSION_COOKIE_SAMESITE=Lax

# -----------------------------------------------------------------------------
# SSO Configuration
# -----------------------------------------------------------------------------
# Azure AD SSO Settings (for testing/development)
# In production, each tenant will configure their own Azure AD app
AZURE_CLIENT_ID=your-azure-client-id
AZURE_TENANT_ID=your-azure-tenant-id    # Use 'common' for multi-tenant apps
AZURE_REDIRECT_URI=http://localhost:4999/api/auth/sso/azure/callback

# SSO Session Settings
SSO_SESSION_TIMEOUT=3600              # 1 hour in seconds
SSO_STATE_TOKEN_LENGTH=32
SSO_PKCE_CODE_LENGTH=43

# SSO Token Refresh Settings (for Celery)
SSO_TOKEN_REFRESH_THRESHOLD_MINUTES=30    # Refresh tokens expiring in next 30 minutes
SSO_TOKEN_REFRESH_BATCH_SIZE=100          # Process 100 tokens per batch
SSO_TOKEN_REFRESH_INTERVAL_SECONDS=300    # Run refresh task every 5 minutes

# Vault Transit Engine for SSO Token Encryption (optional)
VAULT_TRANSIT_KEY_NAME=sso-tokens
VAULT_TRANSIT_ENGINE_PATH=transit

# -----------------------------------------------------------------------------
# Redis Configuration (for SSO sessions and Celery)
# -----------------------------------------------------------------------------
REDIS_URL=redis://localhost:6379/0
REDIS_MAX_CONNECTIONS=20
REDIS_DECODE_RESPONSES=True
REDIS_SSO_SESSION_PREFIX=sso:session:
REDIS_SSO_SESSION_TTL=3600           # 1 hour

# -----------------------------------------------------------------------------
# Celery Configuration
# -----------------------------------------------------------------------------
CELERY_BROKER_URL=redis://localhost:6379/1
CELERY_RESULT_BACKEND=redis://localhost:6379/2
CELERY_TASK_SERIALIZER=json
CELERY_RESULT_SERIALIZER=json
CELERY_ACCEPT_CONTENT=json
CELERY_TIMEZONE=UTC
CELERY_ENABLE_UTC=True
CELERY_TASK_TRACK_STARTED=True
CELERY_TASK_TIME_LIMIT=300            # 5 minutes
CELERY_TASK_SOFT_TIME_LIMIT=240       # 4 minutes

# -----------------------------------------------------------------------------
# Application Features
# -----------------------------------------------------------------------------
# Enable/disable features
ENABLE_REGISTRATION=True
ENABLE_FILE_DEDUPLICATION=True
ENABLE_KAFKA_EVENTS=True
ENABLE_AUDIT_LOGGING=True
ENABLE_SSO=True                       # Global SSO feature flag
ENABLE_SSO_AUTO_PROVISIONING=True    # Allow auto-provisioning for all tenants

# Pagination defaults
DEFAULT_PAGE_SIZE=20
MAX_PAGE_SIZE=100

# -----------------------------------------------------------------------------
# Development/Testing Settings (not for production)
# -----------------------------------------------------------------------------
# Set to True to enable SQL query logging
SQLALCHEMY_ECHO=False

# Testing mode
TESTING=False
